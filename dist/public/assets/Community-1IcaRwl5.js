import{j as e}from"./ui-D4qm5_HU.js";import{r as n,R as Gs}from"./vendor--0RGCJ5T.js";import{c as zs,a as Zs,H as Xs,S as Ce,U as Js,A as G,b as Z,d as X,B as x,P as Ie,I as M,X as He,C as I,e as Le,f as Oe,g as D,T as _s,h as Rs,i as Ye,M as ne,j as ke,k as We,l as Be,R as et,m as st,n as tt,o as De,p as is,q as rs,r as ns,s as os,t as ue,u as Me,v as ze,w as ie,x as Ke,y as at,z as cs,D as lt,E as it,F as rt,G as nt,J as Je,K as ye,L as ot,N as ct,O as Os,Q as dt,V as we,W as mt,Y as es,Z as ss,_ as ts,$ as as,a0 as ls,a1 as xt}from"./index-BNOyMxPp.js";import{b as ut}from"./query-DwD54YTm.js";import{F as re,L as ht}from"./constants-KbZiGlkL.js";import{I as ds}from"./image-B3fWv8k3.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=zs("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=zs("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Ds=768;function pt(){const[t,u]=n.useState(void 0);return n.useEffect(()=>{const r=()=>{const N=window.innerWidth<Ds;u(N)},p=window.matchMedia(`(max-width: ${Ds-1}px)`);return p.addEventListener("change",r),r(),()=>p.removeEventListener("change",r)},[]),!!t}const gt=({activeTab:t,onTabChange:u})=>{const r=[{id:"feed",label:"Feed",icon:Xs},{id:"search",label:"Search",icon:Ce},{id:"profile",label:"Profile",icon:Js}];return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-[50] bg-card/95 backdrop-blur-sm border-t border-border",children:e.jsx("div",{className:"flex items-center justify-around h-16 px-4",children:r.map(({id:p,label:N,icon:f})=>e.jsxs("button",{onClick:()=>u(p),className:Zs("flex flex-col items-center justify-center p-2 rounded-lg transition-colors min-h-[44px] min-w-[44px]",t===p?"text-primary bg-primary/10":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),"data-testid":`nav-${p}`,children:[e.jsx(f,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:N})]},p))})})},ft=t=>{switch(t){case"premium":return e.jsx("span",{className:"text-blue-600 font-bold text-xs",children:"🔹"});case"elite":return e.jsx("span",{className:"text-purple-600 font-bold text-xs",children:"💎"});case"free":case null:case void 0:default:return null}},jt=({user:t})=>e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent",children:"Phozos"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[ft(t.subscriptionTier),e.jsxs(G,{className:"w-8 h-8",children:[e.jsx(Z,{src:t.profilePicture}),e.jsxs(X,{className:"text-xs",children:[t.firstName[0],t.lastName[0]]})]})]})]})}),vt=({onClick:t})=>e.jsx(x,{onClick:t,className:"fixed bottom-20 right-4 z-[45] w-14 h-14 rounded-full bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg hover:shadow-xl transition-all duration-200","data-testid":"fab-create-post",children:e.jsx(Ie,{className:"w-6 h-6"})}),Nt=({searchQuery:t,onSearchChange:u,searchResults:r=[],isSearching:p=!1,onTopicClick:N})=>e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5"}),e.jsx(M,{placeholder:"Search by title, tags, content...",className:"pl-12 pr-12 h-12 text-base",value:t,onChange:f=>u(f.target.value),"data-testid":"search-input"}),t&&e.jsx(x,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-9 w-9 p-0",onClick:()=>u(""),"aria-label":"Clear search",children:e.jsx(He,{className:"h-5 w-5"})})]}),t&&e.jsxs(I,{children:[e.jsx(Le,{children:e.jsxs(Oe,{className:"text-lg",children:["Search Results ",r.length>0&&`(${r.length})`]})}),e.jsx(D,{children:p?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(f=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]},f))}):r.length>0?e.jsx("div",{className:"space-y-4",children:r.map(f=>{var v,c;return e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:f.content.length>80?`${f.content.substring(0,80)}...`:f.content}),e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["❤️ ",f.likesCount]}),e.jsxs("span",{children:["💬 ",f.commentsCount]}),e.jsxs("span",{children:["👁️ ",f.viewsCount]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["By ",(v=f.user)==null?void 0:v.firstName," ",(c=f.user)==null?void 0:c.lastName]})]},f.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No results found"}),e.jsxs("p",{className:"text-muted-foreground mb-4 px-4",children:['No posts match "',t,'"']}),e.jsx(x,{variant:"outline",onClick:()=>u(""),children:"Clear Search"})]})})]})]}),bt=({user:t,allPosts:u,savedPosts:r,savedPostsLoading:p,onPostClick:N,getTimeAgo:f})=>{const v=u.filter(c=>c.authorId===t.id);return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsx(I,{children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs(G,{className:"w-16 h-16",children:[e.jsx(Z,{src:t.profilePicture}),e.jsxs(X,{className:"text-lg",children:[t.firstName[0],t.lastName[0]]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold",children:[t.firstName," ",t.lastName]}),t.subscriptionTier&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.subscriptionTier," member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold",children:v.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Posts"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold",children:v.reduce((c,b)=>c+b.likesCount,0)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Likes"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold",children:(r==null?void 0:r.length)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Saved"})]})]})]})}),e.jsx(I,{children:e.jsx(D,{className:"p-0",children:e.jsxs(_s,{defaultValue:"my-posts",className:"w-full",children:[e.jsxs(Rs,{className:"grid w-full grid-cols-2 rounded-none border-b",children:[e.jsxs(Ye,{value:"my-posts",className:"flex items-center space-x-2 data-[state=active]:bg-transparent data-[state=active]:border-b-2 data-[state=active]:border-primary rounded-none",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"My Posts"}),e.jsx("span",{className:"ml-1 text-xs bg-muted px-1.5 py-0.5 rounded-full",children:v.length})]}),e.jsxs(Ye,{value:"saved-posts",className:"flex items-center space-x-2 data-[state=active]:bg-transparent data-[state=active]:border-b-2 data-[state=active]:border-primary rounded-none",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:"Saved"}),e.jsx("span",{className:"ml-1 text-xs bg-muted px-1.5 py-0.5 rounded-full",children:(r==null?void 0:r.length)||0})]})]}),e.jsx(We,{value:"my-posts",className:"p-4 mt-0",children:e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:[v.map(c=>e.jsxs("div",{className:"p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>N(c.id),"data-testid":`my-post-${c.id}`,children:[e.jsx("h4",{className:"text-sm font-medium text-foreground truncate",children:c.content.length>50?c.content.substring(0,50)+"...":c.content}),e.jsxs("div",{className:"flex items-center space-x-3 mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),c.likesCount]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),c.commentsCount]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:f(c.createdAt)})]},c.id)),v.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"You haven't created any posts yet"})]})]})}),e.jsx(We,{value:"saved-posts",className:"p-4 mt-0",children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:p?e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-3"}),e.jsx("p",{children:"Loading saved posts..."})]}):r&&r.length>0?r.map(c=>e.jsxs("div",{className:"p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>N(c.id),"data-testid":`saved-post-${c.id}`,children:[e.jsx("h4",{className:"text-sm font-medium text-foreground truncate",children:c.content.length>50?c.content.substring(0,50)+"...":c.content}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["By ",c.user.firstName," ",c.user.lastName]}),e.jsxs("div",{className:"flex items-center space-x-3 mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),c.likesCount]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),c.commentsCount]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Saved ",f(c.savedAt)]})]},c.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"You haven't saved any posts yet"})]})})})]})})})]})},_e=et,Re=st,Fe=tt,yt=({isOpen:t,onClose:u,onSubmit:r,isSubmitting:p=!1,userType:N})=>{var ce;const[f,v]=n.useState(""),[c,b]=n.useState(""),[S,Ne]=n.useState(((ce=re[0])==null?void 0:ce.id)||"general"),[he,K]=n.useState(""),[pe,o]=n.useState(!1),[P,$]=n.useState(!1),[oe,R]=n.useState(!1),[Y,ge]=n.useState([]),[U,F]=n.useState(""),[z,q]=n.useState(["",""]),[W,h]=n.useState(""),k=()=>{if(!c.trim())return;const j=he.split(",").map(J=>J.trim()).filter(Boolean),H=(c.match(/#\w+/g)||[]).map(J=>J.substring(1)),_=[...j,...H],Pe=Array.from(new Set(_));r({title:N==="company_profile"?f:c.slice(0,50).trim()+(c.length>50?"...":""),content:c,category:S,tags:Pe,images:Y,pollQuestion:U,pollOptions:z.filter(J=>J.trim()!=="").map((J,Se)=>({id:`option_${Se}`,text:J})),pollEndsAt:W})},B=()=>{var j;v(""),b(""),Ne(((j=re[0])==null?void 0:j.id)||"general"),K(""),o(!1),$(!1),R(!1),ge([]),F(""),q(["",""]),h(""),u()};return t?(console.log(`📱 [MOBILE MODAL] isOpen: ${t}`),e.jsxs("div",{className:"fixed inset-0 bg-background z-50 flex flex-col","data-testid":"mobile-create-post-modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-background sticky top-0 z-10",children:[e.jsx("button",{onClick:B,className:"p-2 text-muted-foreground hover:text-foreground","data-testid":"close-create-post",children:e.jsx(He,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold",children:"Create New Post"}),e.jsx("div",{className:"w-9"})," "]}),e.jsxs("div",{className:"flex-1 p-4 space-y-4 pb-20 overflow-y-auto modal-scroll",children:[N==="company_profile"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Post Title"}),e.jsx(M,{placeholder:"Enter a title for your post",value:f,onChange:j=>v(j.target.value),"data-testid":"mobile-post-title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Content"}),e.jsx(De,{placeholder:N==="company_profile"?"What's on your mind?":"Share your thoughts... (max 100 characters)",rows:N==="company_profile"?8:6,value:c,onChange:j=>{const L=j.target.value;N!=="company_profile"&&L.length>100||b(L)},className:"resize-none","data-testid":"mobile-post-content"}),N!=="company_profile"&&e.jsxs("div",{className:"text-right text-xs text-muted-foreground mt-1",children:[c.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Category"}),e.jsxs(is,{value:S,onValueChange:Ne,children:[e.jsx(rs,{"data-testid":"mobile-post-category",children:e.jsx(ns,{placeholder:"Select a category"})}),e.jsx(os,{children:re.map(j=>e.jsx(ue,{value:j.id,children:j.name},j.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Tags (comma-separated)"}),e.jsx(M,{placeholder:"e.g., scholarship, visa, application",value:he,onChange:j=>K(j.target.value),"data-testid":"mobile-post-tags"})]}),N==="company_profile"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_e,{open:pe,onOpenChange:o,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-between","data-testid":"mobile-add-photos-toggle",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Add Photos"]}),pe?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(ze,{className:"w-4 h-4"})]})}),e.jsxs(Fe,{className:"space-y-3 mt-3",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 text-center",children:[e.jsx(ds,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Upload photos to your post"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,style:{display:"none"},id:"mobile-photo-upload",onChange:async j=>{const L=Array.from(j.target.files||[]);if(L.length===0)return;const H=new FormData;L.forEach(_=>{H.append("images",_)});try{const _=await ie.post("/api/forum/upload-images",H);ge(Pe=>[...Pe,..._.imageUrls])}catch(_){console.error("Image upload error:",_)}}}),e.jsx(x,{variant:"outline",size:"sm","data-testid":"mobile-upload-photos",onClick:()=>{var j;return(j=document.getElementById("mobile-photo-upload"))==null?void 0:j.click()},children:"Choose Photos"})]}),Y.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Y.length," photo(s) selected"]})]})]}),e.jsxs(_e,{open:P,onOpenChange:$,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-between","data-testid":"mobile-create-poll-toggle",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Create Poll"]}),P?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(ze,{className:"w-4 h-4"})]})}),e.jsxs(Fe,{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Poll Question"}),e.jsx(M,{placeholder:"Ask a question...",value:U,onChange:j=>F(j.target.value),"data-testid":"mobile-poll-question"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Poll Options"}),z.map((j,L)=>e.jsx("div",{className:"mb-2",children:e.jsx(M,{placeholder:`Option ${L+1}`,value:j,onChange:H=>{const _=[...z];_[L]=H.target.value,q(_)},"data-testid":`mobile-poll-option-${L}`})},L)),z.length<5&&e.jsx(x,{variant:"outline",size:"sm",onClick:()=>q([...z,""]),"data-testid":"mobile-add-poll-option",children:"Add Option"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Poll End Date"}),e.jsx(M,{type:"datetime-local",value:W,onChange:j=>h(j.target.value),"data-testid":"mobile-poll-end-date"})]})]})]}),e.jsxs(_e,{open:oe,onOpenChange:R,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-between","data-testid":"mobile-advanced-options-toggle",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(at,{className:"w-4 h-4 mr-2"}),"Advanced Options"]}),oe?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(ze,{className:"w-4 h-4"})]})}),e.jsx(Fe,{className:"space-y-3 mt-3",children:e.jsxs("div",{className:"text-xs text-muted-foreground p-3 bg-muted/50 rounded",children:[e.jsx("p",{children:"Advanced features:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[e.jsx("li",{children:"• Schedule post publication"}),e.jsx("li",{children:"• Add custom tags"}),e.jsx("li",{children:"• Set post visibility"}),e.jsx("li",{children:"• Enable comments moderation"})]})]})})]})]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Community Guidelines"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Be respectful and constructive"}),e.jsx("li",{children:"• No spam or promotional content"}),e.jsx("li",{children:"• Use hashtags for better discoverability"}),e.jsx("li",{children:"• Report inappropriate content"})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-background border-t z-10",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(x,{variant:"outline",onClick:B,className:"flex-1","data-testid":"mobile-cancel-post",children:"Cancel"}),e.jsx(x,{onClick:k,disabled:p||!c.trim(),className:"flex-1","data-testid":"mobile-submit-post",children:p?"Publishing...":e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Publish"]})})]})})]})):null};function Ms({images:t,initialIndex:u=0,isOpen:r,onClose:p}){const[N,f]=n.useState(u);n.useEffect(()=>{f(u)},[u]),n.useEffect(()=>{const b=S=>{r&&(S.key==="Escape"?p():S.key==="ArrowLeft"?c():S.key==="ArrowRight"&&v())};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[r,N]),n.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[r]);const v=()=>{t.length<2||f(b=>(b+1)%t.length)},c=()=>{t.length<2||f(b=>(b-1+t.length)%t.length)};return!r||!(t!=null&&t.length)?null:e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black/95 flex items-center justify-center",onClick:p,children:[e.jsx(x,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:p,children:e.jsx(He,{className:"h-6 w-6"})}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 disabled:opacity-30",onClick:b=>{b.stopPropagation(),c()},children:e.jsx(lt,{className:"h-8 w-8"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 disabled:opacity-30",onClick:b=>{b.stopPropagation(),v()},children:e.jsx(it,{className:"h-8 w-8"})})]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center p-4 md:p-8",children:e.jsx("img",{src:t[N],alt:`Image ${N+1}`,className:"max-w-full max-h-full object-contain",loading:"lazy",decoding:"async",onClick:b=>b.stopPropagation()})}),t.length>1&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 bg-black/60 text-white px-4 py-2 rounded-full text-sm",children:[N+1," / ",t.length]})]})}const wt=t=>{switch(t){case"premium":return e.jsx("span",{className:"text-blue-600 font-bold text-xs",children:"🔹"});case"elite":return e.jsx("span",{className:"text-purple-600 font-bold text-xs",children:"💎"});case"free":case null:case void 0:default:return null}},Ct=(t,u,r,p,N)=>{let f="max-w-lg",v="max-h-[80vh]";return p==="company_profile"&&((t||u)&&(f="max-w-xl",v="max-h-[85vh]"),t&&u&&(f="max-w-2xl",v="max-h-[90vh]"),r&&(f="max-w-2xl",v="max-h-[90vh]")),`${f} ${v} lg:max-h-[85vh] lg:w-full xl:max-h-[80vh] 2xl:max-h-[75vh] my-4 mx-4 lg:my-8 lg:mx-auto overflow-hidden max-w-[calc(100vw-2rem)] lg:max-w-[calc(100vw-4rem)]`},Qs=Gs.memo(({post:t,userId:u,selectedPost:r,likePostMutationPending:p,savePostMutationPending:N,onLike:f,onSave:v,onComment:c,onShare:b,onReport:S,onPollVote:Ne,onImageClick:he,getTimeAgo:K,isPollExpired:pe})=>{var o,P,$,oe,R,Y,ge,U,F,z,q,W;return e.jsx(I,{className:"hover:shadow-md transition-shadow",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs(G,{className:"w-10 h-10",children:[e.jsx(Z,{src:(o=t.user)==null?void 0:o.profilePicture}),e.jsxs(X,{children:[($=(P=t.user)==null?void 0:P.firstName)==null?void 0:$[0],(R=(oe=t.user)==null?void 0:oe.lastName)==null?void 0:R[0]]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-foreground text-sm",children:((Y=t.user)==null?void 0:Y.userType)==="company_profile"&&((ge=t.user)!=null&&ge.companyName)?t.user.companyName:`${(U=t.user)==null?void 0:U.firstName} ${(F=t.user)==null?void 0:F.lastName}`}),wt((z=t.user)==null?void 0:z.subscriptionTier),e.jsx(we,{variant:"outline",className:"text-xs",children:((q=re.find(h=>h.id===t.category))==null?void 0:q.name)||t.category}),e.jsx("span",{className:"text-muted-foreground text-xs",children:K(t.createdAt)})]}),t.title&&e.jsx("h4",{className:"font-semibold text-foreground text-sm mb-2",children:t.title}),e.jsx("p",{className:"text-foreground text-sm whitespace-pre-wrap mb-3",children:t.content}),t.images&&t.images.length>0&&e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:`grid gap-2 ${t.images.length===1?"grid-cols-1":"grid-cols-2"}`,children:t.images.slice(0,4).map((h,k)=>e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>he(t.images,k),children:[e.jsx("img",{src:h,alt:`Post image ${k+1}`,className:"w-full h-32 object-cover rounded-lg border hover:opacity-90 transition-opacity"}),t.images.length>4&&k===3&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-medium",children:["+",t.images.length-4," more"]})})]},k))})}),t.pollQuestion&&e.jsxs("div",{className:"mb-3 p-3 border rounded-lg bg-muted/20",children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:t.pollQuestion}),e.jsx("div",{className:"space-y-2",children:t.pollOptions&&t.pollOptions.map((h,k)=>{const B=t.userVotes&&t.userVotes.length>0,ce=B&&t.userVotes&&t.userVotes.includes(h.id),j=pe(t.pollEndsAt);return B||j?e.jsxs("div",{className:`flex items-center justify-between p-2 border rounded ${ce?"bg-primary/10 border-primary":"bg-background"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:h.text}),ce&&e.jsx("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-1 rounded",children:"Your choice"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${h.percentage||0}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[h.votes||0," votes"]}),e.jsxs("span",{className:"text-xs font-medium",children:[h.percentage||0,"%"]})]})]},k):e.jsx(x,{variant:"outline",className:"w-full justify-start p-3 h-auto text-sm",onClick:()=>Ne(t.id,h.id),disabled:j,children:h.text},k)})}),t.pollEndsAt&&e.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:pe(t.pollEndsAt)?e.jsx("span",{className:"text-red-500 font-medium",children:"Poll expired"}):e.jsxs("span",{children:["Poll ends: ",new Date(t.pollEndsAt).toLocaleString()]})})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:t.tags.map((h,k)=>e.jsx(we,{variant:"secondary",className:"text-xs",children:h},k))}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:h=>{h.preventDefault(),h.stopPropagation();const k=Date.now(),B=h.currentTarget.getAttribute("data-last-click");B&&k-parseInt(B)<500||(h.currentTarget.setAttribute("data-last-click",k.toString()),p||f(t.id))},disabled:p,className:`h-8 px-2 transition-all duration-200 transform hover:scale-105 active:scale-95 ${t.isLiked?"text-red-500 hover:text-red-600":"text-muted-foreground hover:text-red-500"} ${p?"opacity-70":""}`,"data-testid":`like-post-mobile-${t.id}`,children:[e.jsx(Be,{className:`w-4 h-4 mr-1 transition-all duration-300 ${t.isLiked?"fill-red-500 text-red-500 scale-110":"text-muted-foreground"} ${p?"animate-pulse":""}`}),e.jsx("span",{className:"text-xs",children:p?"...":t.likesCount})]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:h=>{h.preventDefault(),h.stopPropagation(),c(t.id)},onTouchEnd:h=>{h.preventDefault(),h.stopPropagation(),c(t.id)},className:"h-8 px-2","data-testid":`comment-post-${t.id}`,children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-xs",children:t.commentsCount})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:h=>{h.preventDefault(),h.stopPropagation();const k=Date.now(),B=h.currentTarget.getAttribute("data-last-click");B&&k-parseInt(B)<500||(h.currentTarget.setAttribute("data-last-click",k.toString()),N||v(t.id))},disabled:N,className:`h-8 px-2 transition-all duration-200 transform hover:scale-105 active:scale-95 ${t.isSaved?"text-violet-500 hover:text-violet-600":"text-muted-foreground hover:text-violet-500"} ${N?"opacity-70":""}`,"data-testid":`save-post-${t.id}`,children:e.jsx(ke,{className:`w-4 h-4 transition-all duration-300 ${t.isSaved?"fill-violet-500 text-violet-500 scale-110":"text-muted-foreground"} ${N?"animate-pulse":""}`})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>b(t.id),className:"h-8 px-2","data-testid":`share-post-${t.id}`,children:e.jsx(Bs,{className:"w-4 h-4"})}),t.authorId!==u&&((W=t.user)==null?void 0:W.userType)!=="company_profile"&&e.jsx(x,{variant:"ghost",size:"sm",onClick:h=>{h.preventDefault(),h.stopPropagation(),S(t.id)},onTouchEnd:h=>{h.preventDefault(),h.stopPropagation(),S(t.id)},className:"h-8 px-2 text-muted-foreground hover:text-red-500","data-testid":`report-post-${t.id}`,children:e.jsx(Fs,{className:"w-4 h-4"})})]})]})]})]})})})});Qs.displayName="ForumPostCard";function Lt(){const{user:t}=rt(),u=pt(),{toast:r}=nt(),p=ut(),[N,f]=n.useState(null);if(N)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full bg-white p-8 rounded-lg shadow-sm",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Community Temporarily Unavailable"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"We're experiencing technical issues with the community forum."}),e.jsx("button",{onClick:()=>f(null),className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Try Again"})]})});const[v,c]=n.useState("all"),[b,S]=n.useState(!1);n.useEffect(()=>{console.log(`📱 [DEBUG] showCreatePost state changed to: ${b}, isMobile: ${u}`)},[b,u]);const[Ne,he]=n.useState(!1),[K,pe]=n.useState(null),[o,P]=n.useState({title:"",content:"",category:"",tags:[],images:[],pollQuestion:"",pollOptions:[],pollEndsAt:""}),[$,oe]=n.useState(null),[R,Y]=n.useState(""),[ge,U]=n.useState(!1),[F,z]=n.useState(null),[q,W]=n.useState(""),[h,k]=n.useState(""),[B,ce]=n.useState(new Set),[j,L]=n.useState(!1),[H,_]=n.useState(!1),[Pe,J]=n.useState(!0),Se=()=>{S(!1),L(!1),_(!1),J(!1),P({title:"",content:"",category:"",tags:[],images:[],pollQuestion:"",pollOptions:[],pollEndsAt:""})},[A,E]=n.useState([]),[ms,xs]=n.useState(1),[$e,us]=n.useState(!0),[ee,hs]=n.useState(!1),Te=n.useRef(null),[se,ps]=n.useState("feed"),[be,Ae]=n.useState(""),[te,Vs]=n.useState(""),[gs,fs]=n.useState(!1),[js,Us]=n.useState(!1);n.useEffect(()=>{u&&!js&&(console.log("📱 [MOBILE TAB INIT] Initializing mobile tab to 'feed'"),ps("feed"),Us(!0))},[u,js]),n.useEffect(()=>{u&&console.log(`📱 [MOBILE TAB DEBUG] activeTab is: ${se}`)},[se,u]),n.useEffect(()=>{const s=setTimeout(()=>{Vs(be)},300);return()=>clearTimeout(s)},[be]);const[vs,Ge]=n.useState(!1),[Ns,qs]=n.useState([]),[bs,Ks]=n.useState(0),ys=(s,a=0)=>{qs(s),Ks(a),Ge(!0)},{data:fe=[],isLoading:ws}=Je(["/api/forum/saved"],"/api/forum/saved",void 0,{staleTime:0}),Ze=ye(async({postId:s,reportReason:a,reportDetails:l})=>await ie.post(`/api/forum/posts/${s}/report`,{reportReason:a,reportDetails:l}),{onSuccess:()=>{r({title:"Post Reported",description:"Thank you for your report. Our team will review it shortly."}),F&&ce(s=>new Set(Array.from(s).concat([F]))),U(!1),z(null),W(""),k("")},onError:s=>{const a=(s==null?void 0:s.message)||"";a.includes("already reported")?(F&&ce(l=>new Set(Array.from(l).concat([F]))),r({title:"Already Reported",description:"You have already reported this post. Our team will review it.",variant:"default"})):a.includes("Unauthorized")?r({title:"Please Log In",description:"You need to be logged in to report posts.",variant:"destructive"}):r({title:"Report Failed",description:a||"Failed to report post. Please try again.",variant:"destructive"}),U(!1),z(null),W(""),k("")}});ot({onMessage:s=>{var a,l,i,d,w,O;s.type==="forum_post_created"?(a=s.data)!=null&&a.post?E(y=>y.some(C=>C.id===s.data.post.id)?y:[s.data.post,...y]):p.invalidateQueries({queryKey:["/api/forum/posts"]}):s.type==="forum_post_updated"?(p.invalidateQueries({queryKey:["/api/forum/posts"]}),(l=s.data)!=null&&l.postId&&p.invalidateQueries({queryKey:["/api/forum/posts",s.data.postId,"comments"]})):s.type==="post_reported"?E(y=>y.map(g=>{var C,Q;return g.id===((C=s.data)==null?void 0:C.postId)?{...g,reportCount:((Q=s.data)==null?void 0:Q.reportCount)||0}:g})):s.type==="post_auto_hidden"?(E(y=>y.filter(g=>{var C;return g.id!==((C=s.data)==null?void 0:C.postId)})),console.log(`🔇 Post ${(i=s.data)==null?void 0:i.postId} silently removed from forum due to reports`)):s.type==="post_restored"?p.invalidateQueries({queryKey:["/api/forum/posts"]}):s.type==="post_permanently_deleted"?E(y=>y.filter(g=>{var C;return g.id!==((C=s.data)==null?void 0:C.postId)})):s.type==="forum_comment_created"?(d=s.data)!=null&&d.postId&&(p.invalidateQueries({queryKey:["/api/forum/posts",s.data.postId,"comments"]}),p.invalidateQueries({queryKey:["/api/forum/posts"]})):s.type==="forum_post_like_update"?(w=s.data)!=null&&w.postId&&(E(y=>y.map(g=>g.id===s.data.postId?{...g,likesCount:s.data.newLikeCount,isLiked:s.data.userId===(t==null?void 0:t.id)?s.data.liked:g.isLiked}:g)),K===s.data.postId&&p.invalidateQueries({queryKey:["/api/forum/posts",s.data.postId,"analytics"]})):s.type==="poll_vote_update"&&(O=s.data)!=null&&O.postId&&((()=>{if(s.data.showResults!==void 0)return s.data.showResults;if(s.data.pollResults){const g=A.find(C=>C.id===s.data.postId);return(g==null?void 0:g.userVotes)&&g.userVotes.length>0}return!1})()?(E(g=>g.map(C=>{var Q;return C.id===s.data.postId?{...C,pollOptions:s.data.pollOptions||((Q=s.data.pollResults)==null?void 0:Q.options),userVotes:s.data.userId===(t==null?void 0:t.id)?s.data.userVotes||s.data.userVotes:C.userVotes}:C})),console.log(`✅ Poll update applied for user ${t==null?void 0:t.id} on post ${s.data.postId}`),p.invalidateQueries({queryKey:["/api/forum/posts",s.data.postId,"poll"],exact:!1})):console.log(`🔒 Poll update ignored for non-voter on post ${s.data.postId}`))},userId:t==null?void 0:t.id,autoReconnect:!0});const Qe=n.useCallback(async(s=1,a=!1)=>{var l;if(t)try{hs(!0),te.trim()&&fs(!0);let i="/api/forum/posts";const d=new URLSearchParams;v!=="all"&&d.append("category",v),te.trim()&&d.append("search",te.trim()),d.append("page",s.toString()),d.append("limit","20"),d.toString()&&(i+=`?${d.toString()}`);const w=await ie.get(i),O=Array.isArray(w)?w:w.posts||[];E(a||s===1?O:g=>{const C=new Set(g.map(m=>m.id)),Q=O.filter(m=>!C.has(m.id));return[...g,...Q]});const y=w.pagination||((l=w.meta)==null?void 0:l.pagination);us((y==null?void 0:y.hasNext)||!1)}catch(i){console.error("Failed to load posts:",i),r({title:"Error",description:"Failed to load posts. Please try again.",variant:"destructive"})}finally{hs(!1),fs(!1)}},[t,v,te,r]);n.useEffect(()=>{t&&(console.log(`🔄 [${u?"MOBILE":"DESKTOP"}] Loading posts for category:`,v,"search:",te),E([]),xs(1),us(!0),Qe(1,!0))},[v,te,Qe,t,u]),n.useEffect(()=>{const s=new IntersectionObserver(a=>{if(a[0].isIntersecting&&$e&&!ee){const i=ms+1;xs(i),Qe(i,!1)}},{threshold:.1,rootMargin:"100px"});return Te.current&&s.observe(Te.current),()=>{Te.current&&s.unobserve(Te.current)}},[$e,ee,ms,Qe]);const{data:Ve=[],isLoading:Cs,error:Pt}=Je(["/api/forum/posts",$,"comments"],$?`/api/forum/posts/${$}/comments`:"",void 0,{enabled:!!$&&!!t,staleTime:1*60*1e3}),{data:ae,isLoading:Ys}=Je(["/api/forum/posts",K,"analytics"],K?`/api/forum/posts/${K}/analytics`:"",void 0,{enabled:!!K&&!!t,staleTime:30*1e3}),Ue=ye(async s=>await ie.post("/api/forum/posts",s),{onSuccess:s=>{Se(),r({title:"Post created",description:"Your post has been successfully published."})},onError:s=>{var i,d,w,O,y;let a="Posting Error",l="Failed to create post. Please try again.";if(((i=s==null?void 0:s.response)==null?void 0:i.status)===403){const g=s.response.data||{};if(g.coolingPeriodEnds){const C=new Date(g.coolingPeriodEnds),Q=Math.ceil((C.getTime()-Date.now())/(1e3*60));a="Account Cooling Period",l=`New accounts must wait 1 hour before posting. Time remaining: ${Q} minutes.`}else a="Access Restricted",l=g.message||"You don't have permission to create posts yet."}else if(((d=s==null?void 0:s.response)==null?void 0:d.status)===429){const g=s.response.data||{};g.waitTime?(a="Please Wait",l=`Please wait ${g.waitTime} seconds before posting again.`):g.dailyLimit&&(a="Daily Limit Reached",l=`You've reached the daily post limit (${g.dailyLimit} posts). Try again tomorrow.`)}else((w=s==null?void 0:s.response)==null?void 0:w.status)===400&&(a="Content Validation Error",l=((y=(O=s.response)==null?void 0:O.data)==null?void 0:y.message)||s.message||"Your post doesn't meet community guidelines.");r({title:a,description:l,variant:"destructive"})}}),Ee=ye(async({postId:s,content:a})=>await ie.post(`/api/forum/posts/${s}/comments`,{content:a}),{onSuccess:()=>{p.invalidateQueries({queryKey:["/api/forum/posts",$,"comments"]}),p.invalidateQueries({queryKey:["/api/forum/posts"]}),Y(""),r({title:"Comment added",description:"Your comment has been posted."})},onError:()=>{r({title:"Error",description:"Failed to post comment. Please try again.",variant:"destructive"})}}),le=ye(async s=>await ie.post(`/api/forum/posts/${s}/like`),{onMutate:async s=>{const a=A;return E(l=>l.map(i=>{if(i.id===s){const d=!i.isLiked,w=d?(i.likesCount||0)+1:Math.max((i.likesCount||0)-1,0);return{...i,isLiked:d,likesCount:w}}return i})),{previousPosts:a,postId:s}},onSuccess:(s,a)=>{E(l=>l.map(i=>i.id===a?{...i,likesCount:s.likesCount,isLiked:s.liked}:i))},onError:(s,a,l)=>{l!=null&&l.previousPosts&&E(l.previousPosts),r({title:"Error",description:"Failed to like post. Please try again.",variant:"destructive"})}}),de=ye(async s=>await ie.post(`/api/forum/posts/${s}/save`),{onMutate:async s=>{const a=A;return E(l=>l.map(i=>{if(i.id===s){const d=!i.isSaved;return{...i,isSaved:d}}return i})),{previousPosts:a,postId:s}},onSuccess:(s,a)=>{E(i=>i.map(d=>d.id===a?{...d,isSaved:s.saved}:d));const l=s.saved;r({title:l?"Post saved":"Post unsaved",description:l?"Post has been saved to your collection.":"Post has been removed from your collection."}),p.invalidateQueries({queryKey:["/api/forum/saved"]})},onError:(s,a,l)=>{l!=null&&l.previousPosts&&E(l.previousPosts),r({title:"Error",description:"Failed to save post. Please try again.",variant:"destructive"})}}),ks=async s=>{try{const a=`${window.location.origin}/community?post=${s}`;navigator.share?await navigator.share({title:"Check out this post on Phozos",text:"Interesting discussion happening here",url:a}):(await navigator.clipboard.writeText(a),r({title:"Link copied!",description:"Post link has been copied to your clipboard."}))}catch{r({title:"Share this post",description:`Copy this link: ${window.location.origin}/community?post=${s}`,duration:8e3})}},Ps=()=>{var l;const s=o.content.trim();if(!s){r({title:"Validation Error",description:"Please write something to post.",variant:"destructive"});return}if((t==null?void 0:t.userType)!=="company_profile"){if(/(https?:\/\/|www\.|[a-zA-Z0-9-]+\.[a-zA-Z]{2,})/i.test(s)){r({title:"Links Not Allowed",description:"Please remove links from your post. Only text content is allowed.",variant:"destructive"});return}if(/(\+?\d[\d\s\-\(\)]{7,}|\b\d{3}[\s\-]?\d{3}[\s\-]?\d{4}\b)/.test(s)){r({title:"Phone Numbers Not Allowed",description:"Please remove phone numbers from your post.",variant:"destructive"});return}if(s.length>100){r({title:"Content Too Long",description:"Posts cannot exceed 100 characters including spaces.",variant:"destructive"});return}}const a={title:(t==null?void 0:t.userType)==="company_profile"&&o.title?o.title:null,content:s,category:o.category||((l=re[0])==null?void 0:l.id)||"general",tags:o.tags||[]};if((t==null?void 0:t.userType)==="company_profile"&&(o.images.length>0&&(a.images=o.images),o.pollQuestion&&o.pollOptions.length>=2))if(a.pollQuestion=o.pollQuestion,a.pollOptions=o.pollOptions.filter(i=>i.text.trim()).map((i,d)=>({id:`option_${d}`,text:i.text.trim()})),o.pollEndsAt)a.pollEndsAt=new Date(o.pollEndsAt).toISOString();else{const i=new Date;i.setDate(i.getDate()+7),a.pollEndsAt=i.toISOString()}Ue.mutate(a)},Ss=()=>{!R.trim()||!$||Ee.mutate({postId:$,content:R})},$s=s=>{z(s),U(!0)},Ws=()=>{!F||!q.trim()||Ze.mutate({postId:F,reportReason:q,reportDetails:h||void 0})},Hs=ye(async({postId:s,optionId:a})=>await ie.post(`/api/forum/posts/${s}/poll/vote/${a}`),{onSuccess:(s,a)=>{const l=s;E(i=>i.map(d=>{var w;return d.id===a.postId?{...d,pollOptions:((w=l.pollResults)==null?void 0:w.options)||d.pollOptions,userVotes:l.userVotes||d.userVotes||[]}:d})),r({title:"Vote Submitted",description:"Your vote has been recorded successfully!"})},onError:s=>{var a,l;(a=s==null?void 0:s.message)!=null&&a.includes("expired")||(l=s==null?void 0:s.message)!=null&&l.includes("POLL_EXPIRED")?(r({title:"Poll Expired",description:"This poll is no longer accepting votes.",variant:"destructive"}),p.invalidateQueries({queryKey:["/api/forum/posts"]})):r({title:"Vote Failed",description:s.message||"Failed to submit your vote. Please try again.",variant:"destructive"})}}),qe=s=>s?new Date>new Date(s):!1,Ts=(s,a)=>{if(!t){r({title:"Please Log In",description:"You need to be logged in to vote on polls.",variant:"destructive"});return}const l=A.find(i=>i.id===s);if(l!=null&&l.pollEndsAt&&qe(l.pollEndsAt)){r({title:"Poll Expired",description:"This poll is no longer accepting votes.",variant:"destructive"});return}Hs.mutate({postId:s,optionId:a})},je=s=>{const a=new Date(s),i=Math.floor((new Date().getTime()-a.getTime())/1e3);return i<60?"just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:`${Math.floor(i/86400)}d ago`},me=n.useMemo(()=>A.filter(s=>!(s.isHiddenByReports&&(t==null?void 0:t.userType)!=="admin")),[A,t]);if(n.useEffect(()=>{u&&(console.log(`📱 [MOBILE DEBUG] allPosts length: ${A.length}, filteredPosts length: ${me.length}`),console.log(`📱 [MOBILE DEBUG] activeTab: ${se}, user: ${t?"authenticated":"not authenticated"}`),console.log(`📱 [MOBILE DEBUG] isLoadingMore: ${ee}, hasMore: ${$e}`))},[u,A.length,me.length,se,t,ee,$e]),!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(A.length===0&&ee)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsx(ct,{type:"card",count:4})})});const Xe=s=>{pe(s),he(!0)},As=()=>{var s,a;return e.jsx(es,{open:Ne,onOpenChange:he,children:e.jsxs(ss,{className:"max-w-[95vw] max-h-[90vh] md:max-w-lg lg:max-w-xl overflow-y-auto",children:[e.jsxs(ts,{children:[e.jsx(as,{children:"Post Analytics"}),e.jsx(ls,{children:"View detailed engagement statistics for this post"})]}),Ys?e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-muted rounded"})]})}):ae?e.jsxs(_s,{defaultValue:"likes",className:"w-full",children:[e.jsxs(Rs,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ye,{value:"likes",children:["Likes (",((s=ae.likes)==null?void 0:s.length)||0,")"]}),e.jsxs(Ye,{value:"comments",children:["Comments (",((a=ae.comments)==null?void 0:a.length)||0,")"]})]}),e.jsx(We,{value:"likes",className:"space-y-4 mt-4",children:e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:ae.likes&&ae.likes.length>0?ae.likes.map(l=>{var i,d;return e.jsxs("div",{className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-muted/50",children:[e.jsxs(G,{className:"w-8 h-8",children:[e.jsx(Z,{src:l.profilePicture}),e.jsx(X,{className:"text-xs",children:l.userType==="company_profile"&&l.companyName?l.companyName.charAt(0):`${((i=l.firstName)==null?void 0:i[0])||""}${((d=l.lastName)==null?void 0:d[0])||""}`})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:l.userType==="company_profile"&&l.companyName?l.companyName:`${l.firstName} ${l.lastName}`}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(l.createdAt).toLocaleDateString()})]})]},l.id)}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Be,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No likes yet"})]})})}),e.jsx(We,{value:"comments",className:"space-y-4 mt-4",children:e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:ae.comments&&ae.comments.length>0?ae.comments.map(l=>{var i,d;return e.jsxs("div",{className:"space-y-2 p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(G,{className:"w-6 h-6",children:[e.jsx(Z,{src:l.profilePicture}),e.jsxs(X,{className:"text-xs",children:[(i=l.firstName)==null?void 0:i[0],(d=l.lastName)==null?void 0:d[0]]})]}),e.jsxs("div",{className:"text-sm font-medium",children:[l.firstName," ",l.lastName]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(l.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-foreground ml-8",children:l.content})]},l.id)}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No comments yet"})]})})})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ke,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No analytics data available"})]})]})})};return u?(console.log(`📱 [MOBILE RENDER] Rendering mobile view with ${me.length} filtered posts, activeTab: ${se}`),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(jt,{user:{firstName:t.firstName,lastName:t.lastName,profilePicture:t.profilePicture||void 0,subscriptionTier:t.subscriptionTier}}),e.jsxs("div",{className:"pt-16 pb-20",children:[se==="feed"&&e.jsxs("div",{className:"space-y-4 p-4",children:[me.length===0?e.jsx(I,{children:e.jsx(D,{className:"p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(Os,{className:"w-12 h-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:ee?"Loading posts...":"No posts yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:ee?"Please wait while we load the community posts.":"Be the first to start a conversation!"}),!ee&&e.jsxs(x,{onClick:()=>{console.log("📱 [MOBILE] Create First Post button clicked, setting showCreatePost to true"),S(!0)},"data-testid":"create-first-post",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Create First Post"]})]})]})})}):me.map(s=>e.jsxs("div",{children:[e.jsx(Qs,{post:s,userId:t==null?void 0:t.id,selectedPost:$,likePostMutationPending:le.isPending,savePostMutationPending:de.isPending,onLike:a=>le.mutate(a),onSave:a=>de.mutate(a),onComment:a=>oe($===a?null:a),onShare:ks,onReport:$s,onPollVote:Ts,onImageClick:ys,getTimeAgo:je,isPollExpired:qe}),e.jsx(I,{className:"border-t-0 rounded-t-none",children:$===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t mx-4",children:[e.jsxs("div",{className:"flex space-x-3 mb-4",children:[e.jsxs(G,{className:"w-8 h-8",children:[e.jsx(Z,{src:t.profilePicture||void 0}),e.jsxs(X,{className:"text-xs",children:[t.firstName[0],t.lastName[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(De,{placeholder:"Write a comment...",value:R,onChange:a=>Y(a.target.value),rows:2,className:"mb-2 text-sm"}),e.jsxs(x,{size:"sm",onClick:Ss,disabled:!R.trim()||Ee.isPending,children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),Ee.isPending?"Posting...":"Comment"]})]})]}),Cs?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]})}):e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:[Ve.map(a=>{var l,i,d,w,O,y,g;return e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(G,{className:"w-7 h-7",children:[e.jsx(Z,{src:(l=a.user)==null?void 0:l.profilePicture}),e.jsxs(X,{className:"text-xs",children:[(d=(i=a.user)==null?void 0:i.firstName)==null?void 0:d[0],(O=(w=a.user)==null?void 0:w.lastName)==null?void 0:O[0]]})]}),e.jsxs("div",{className:"flex-1 bg-muted rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsxs("span",{className:"font-medium text-sm",children:[(y=a.user)==null?void 0:y.firstName," ",(g=a.user)==null?void 0:g.lastName]}),e.jsx("span",{className:"text-muted-foreground text-xs",children:je(a.createdAt)})]}),e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:a.content})]})]},a.id)}),Ve.length===0&&e.jsx("p",{className:"text-center text-muted-foreground text-sm py-4",children:"No comments yet. Be the first to comment!"})]})]})})]},s.id)),$e&&e.jsx("div",{ref:Te,className:"flex justify-center py-4",children:ee&&e.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),e.jsx("span",{className:"text-sm",children:"Loading more..."})]})})]}),se==="search"&&e.jsx(Nt,{searchQuery:be,onSearchChange:Ae,searchResults:me,isSearching:gs}),se==="profile"&&e.jsx(bt,{user:{id:t.id,firstName:t.firstName,lastName:t.lastName,profilePicture:t.profilePicture||void 0,subscriptionTier:t.subscriptionTier},allPosts:A,savedPosts:Array.isArray(fe)?fe:[],savedPostsLoading:ws,onPostClick:Xe,getTimeAgo:je})]}),e.jsx(gt,{activeTab:se,onTabChange:s=>{console.log(`📱 [MOBILE TAB CHANGE] User clicked tab: ${s}`),ps(s)}}),e.jsx(vt,{onClick:()=>S(!0)}),e.jsx(yt,{isOpen:u&&b,onClose:Se,onSubmit:s=>{P({...o,title:s.title,content:s.content,category:s.category,tags:s.tags,images:s.images||[],pollQuestion:s.pollQuestion||"",pollOptions:s.pollOptions||[],pollEndsAt:s.pollEndsAt||""}),Ps()},isSubmitting:Ue.isPending,userType:t==null?void 0:t.userType}),e.jsx(Ms,{images:Ns,initialIndex:bs,isOpen:vs,onClose:()=>Ge(!1)}),As()]})):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(dt,{}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-24",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsx("div",{className:"space-y-6",children:me.length===0?e.jsx(I,{children:e.jsx(D,{className:"p-8 text-center",children:e.jsx("div",{className:"flex flex-col items-center space-y-4",children:te?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-12 h-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No results found"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:['No posts match "',te,'". Try different keywords or check your spelling.']}),e.jsx(x,{variant:"outline",onClick:()=>Ae(""),children:"Clear Search"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-12 h-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:v==="all"?"No posts yet":"No posts in this category"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:v==="all"?"Be the first to start a conversation in the community!":"Be the first to post in this category!"}),e.jsxs(x,{onClick:()=>S(!0),children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Create First Post"]})]})]})})})}):me.map(s=>{var a,l,i,d,w,O,y,g,C,Q;return e.jsxs(I,{className:"hover:shadow-md transition-shadow",children:[e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(G,{children:[e.jsx(Z,{src:"/api/placeholder/40/40"}),e.jsx(X,{children:((l=(a=s.user)==null?void 0:a.firstName)==null?void 0:l.charAt(0))||((d=(i=s.user)==null?void 0:i.companyName)==null?void 0:d.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-medium text-foreground",children:((w=s.user)==null?void 0:w.userType)==="company_profile"&&((O=s.user)!=null&&O.companyName)?s.user.companyName:`${((y=s.user)==null?void 0:y.firstName)||""} ${((g=s.user)==null?void 0:g.lastName)||""}`.trim()}),e.jsx(we,{variant:"outline",className:"text-xs",children:((C=re.find(m=>m.id===s.category))==null?void 0:C.name)||s.category}),e.jsx("span",{className:"text-sm text-muted-foreground",children:je(s.createdAt)})]}),s.title&&e.jsx("h4",{className:"font-semibold text-foreground mb-2",children:s.title}),e.jsx("p",{className:"text-muted-foreground mb-3",children:s.content}),s.images&&s.images.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:`grid gap-3 ${s.images.length===1?"grid-cols-1":s.images.length===2?"grid-cols-2":"grid-cols-3"}`,children:s.images.slice(0,6).map((m,T)=>e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>ys(s.images,T),children:[e.jsx("img",{src:m,alt:`Post image ${T+1}`,className:"w-full h-40 object-cover rounded-lg border hover:opacity-90 transition-opacity"}),s.images.length>6&&T===5&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-60 rounded-lg flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-medium text-lg",children:["+",s.images.length-6," more"]})})]},T))})}),s.pollQuestion&&e.jsxs("div",{className:"mb-4 p-4 border rounded-lg bg-muted/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ke,{className:"w-4 h-4 text-primary"}),e.jsx("h5",{className:"font-semibold text-foreground",children:s.pollQuestion})]}),e.jsx("div",{className:"space-y-3",children:s.pollOptions&&s.pollOptions.map((m,T)=>{const V=s.userVotes&&s.userVotes.length>0,xe=V&&s.userVotes&&s.userVotes.includes(m.id),ve=qe(s.pollEndsAt);return V||ve?e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${xe?"bg-primary/10 border-primary/20":"bg-background"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[xe&&e.jsx("div",{className:"w-4 h-4 bg-primary rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-primary-foreground rounded-full"})}),e.jsx("span",{className:`font-medium ${xe?"text-primary":""}`,children:m.text}),xe&&e.jsx("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-1 rounded",children:"Your choice"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[m.votes||0," votes"]}),e.jsxs("span",{className:"text-sm font-medium",children:[m.percentage||0,"%"]})]}),ve&&!V&&e.jsx("div",{className:"text-xs text-muted-foreground italic",children:"Poll expired - no votes recorded"})]}),e.jsx("div",{className:"mt-2 w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${xe?"bg-primary":"bg-primary/60"}`,style:{width:`${m.percentage||0}%`}})})]},T):e.jsx("div",{className:"group",children:e.jsx("div",{className:`flex items-center justify-between p-3 border rounded-lg transition-colors ${ve?"bg-muted/10 cursor-not-allowed opacity-50":"bg-background hover:bg-muted/20 cursor-pointer"}`,onClick:()=>!ve&&Ts(s.id,m.id),children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium",children:m.text})})})},T)})}),s.pollEndsAt&&e.jsxs("div",{className:"mt-3 text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(mt,{className:"w-3 h-3"}),qe(s.pollEndsAt)?e.jsx("span",{className:"text-red-500 font-medium",children:"Poll expired"}):e.jsxs("span",{children:["Poll ends: ",new Date(s.pollEndsAt).toLocaleDateString()]})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:s.tags.map((m,T)=>e.jsxs(we,{variant:"secondary",className:"text-xs",children:["#",m]},T))}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:m=>{m.preventDefault(),m.stopPropagation();const T=Date.now(),V=m.currentTarget.getAttribute("data-last-click");V&&T-parseInt(V)<500||(m.currentTarget.setAttribute("data-last-click",T.toString()),le.isPending||le.mutate(s.id))},disabled:le.isPending,className:`h-8 px-2 transition-all duration-200 transform hover:scale-105 active:scale-95 ${s.isLiked?"text-red-500 hover:text-red-600":"text-muted-foreground hover:text-red-500"} ${le.isPending?"opacity-70":""}`,"data-testid":`like-post-desktop-${s.id}`,children:[e.jsx(Be,{className:`w-4 h-4 mr-1 transition-all duration-300 ${s.isLiked?"fill-red-500 text-red-500 scale-110":"text-muted-foreground"} ${le.isPending?"animate-pulse":""}`}),e.jsx("span",{className:`${le.isPending?"animate-pulse":""}`,children:le.isPending?"...":s.likesCount||0})]}),e.jsxs(x,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>oe($===s.id?null:s.id),children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),s.commentsCount||0]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:m=>{m.preventDefault(),m.stopPropagation();const T=Date.now(),V=m.currentTarget.getAttribute("data-last-click");V&&T-parseInt(V)<500||(m.currentTarget.setAttribute("data-last-click",T.toString()),de.isPending||de.mutate(s.id))},disabled:de.isPending,className:`h-8 px-2 transition-all duration-200 transform hover:scale-105 active:scale-95 ${s.isSaved?"text-violet-500 hover:text-violet-600":"text-muted-foreground hover:text-violet-500"} ${de.isPending?"opacity-70":""}`,"data-testid":`save-post-desktop-${s.id}`,children:[e.jsx(ke,{className:`w-4 h-4 mr-1 transition-all duration-300 ${s.isSaved?"fill-violet-500 text-violet-500 scale-110":"text-muted-foreground"} ${de.isPending?"animate-pulse":""}`}),de.isPending?"Saving...":s.isSaved?"Saved":"Save"]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:m=>{m.preventDefault(),m.stopPropagation(),ks(s.id)},className:"h-8 px-2","data-testid":`share-post-desktop-${s.id}`,children:[e.jsx(Bs,{className:"w-4 h-4 mr-1"}),"Share"]}),s.authorId!==(t==null?void 0:t.id)&&((Q=s.user)==null?void 0:Q.userType)!=="company_profile"&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:m=>{m.preventDefault(),m.stopPropagation(),$s(s.id)},className:"h-8 px-2 text-muted-foreground hover:text-red-500","data-testid":`report-post-desktop-${s.id}`,children:[e.jsx(Fs,{className:"w-4 h-4 mr-1"}),"Report"]})]})]})]})}),$===s.id&&e.jsx("div",{className:"px-6 pb-6 pt-0",children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex space-x-4 mb-4",children:[e.jsxs(G,{children:[e.jsx(Z,{src:t.profilePicture||void 0}),e.jsxs(X,{children:[t.firstName[0],t.lastName[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(De,{placeholder:"Write a comment...",value:R,onChange:m=>Y(m.target.value),rows:3,className:"mb-3"}),e.jsxs(x,{size:"sm",onClick:Ss,disabled:!R.trim()||Ee.isPending,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),Ee.isPending?"Posting...":"Comment"]})]})]}),Cs?e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]})}):e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-1",children:[Ve.map(m=>{var T,V,xe,ve,Es,Is,Ls;return e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs(G,{children:[e.jsx(Z,{src:(T=m.user)==null?void 0:T.profilePicture}),e.jsxs(X,{children:[(xe=(V=m.user)==null?void 0:V.firstName)==null?void 0:xe[0],(Es=(ve=m.user)==null?void 0:ve.lastName)==null?void 0:Es[0]]})]}),e.jsxs("div",{className:"flex-1 bg-muted rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs("span",{className:"font-medium",children:[(Is=m.user)==null?void 0:Is.firstName," ",(Ls=m.user)==null?void 0:Ls.lastName]}),e.jsx("span",{className:"text-muted-foreground text-sm",children:je(m.createdAt)})]}),e.jsx("p",{className:"text-foreground whitespace-pre-wrap",children:m.content})]})]},m.id)}),Ve.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-6",children:"No comments yet. Be the first to comment!"})]})]})})]},s.id)})})}),e.jsxs("div",{className:"h-[calc(100vh-6rem)] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"block md:hidden space-y-6",children:[e.jsx(I,{children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Search Posts"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search posts...",value:be,onChange:s=>Ae(s.target.value),className:"pl-10"})]})]})})}),e.jsx(I,{children:e.jsx(D,{className:"p-6",children:e.jsxs(x,{onClick:()=>S(!0),className:"w-full","data-testid":"create-post-button",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Create Post"]})})})]}),e.jsx(I,{className:"hidden md:block sticky top-16 z-40 bg-background mb-10",children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search by title, tags, content, author...",value:be,onChange:s=>Ae(s.target.value),className:"pl-10 pr-10"}),be&&e.jsx(x,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7 p-0 hover:bg-muted",onClick:()=>Ae(""),"aria-label":"Clear search",children:e.jsx(He,{className:"h-4 w-4"})})]})}),e.jsxs(x,{onClick:()=>S(!0),className:"shrink-0","data-testid":"create-post-button",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Create Post"]})]}),te&&gs&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ht,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Searching..."})]})]})})}),e.jsxs(I,{className:"hidden",children:[e.jsx(Le,{children:e.jsx(Oe,{className:"text-lg",children:"Categories"})}),e.jsx(D,{className:"p-0",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{variant:v==="all"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>c("all"),children:"All Posts"}),re.map(s=>e.jsx(x,{variant:v===s.id?"secondary":"ghost",className:"w-full justify-start",onClick:()=>c(s.id),children:s.name},s.id))]})})]}),e.jsxs(I,{children:[e.jsx(Le,{children:e.jsxs(Oe,{className:"text-lg flex items-center",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"My Posts"]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:A.filter(s=>s.authorId===(t==null?void 0:t.id)).length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Posts"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:A.filter(s=>s.authorId===(t==null?void 0:t.id)).reduce((s,a)=>s+(a.likesCount||0),0)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Likes"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:Array.isArray(fe)?fe.length:0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Saved"})]})]}),A.filter(s=>s.authorId===(t==null?void 0:t.id)).length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ne,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You haven't created any posts yet"})]}):e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto pr-2",children:A.filter(s=>s.authorId===(t==null?void 0:t.id)).slice(0,10).map(s=>e.jsxs("div",{className:"p-3 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>Xe(s.id),children:[s.title&&e.jsx("h4",{className:"font-medium text-sm line-clamp-1",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mt-1",children:s.content}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:je(s.createdAt)}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{children:[s.likesCount||0," likes"]}),e.jsxs("span",{children:[s.commentsCount||0," comments"]})]})]})]},s.id))})]})})]}),e.jsxs(I,{children:[e.jsx(Le,{children:e.jsxs(Oe,{className:"text-lg flex items-center",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Saved Posts"]})}),e.jsx(D,{children:ws?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-16 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-16 bg-muted rounded animate-pulse"})]}):!Array.isArray(fe)||fe.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ke,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No saved posts yet"})]}):e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto pr-2",children:fe.slice(0,10).map(s=>e.jsxs("div",{className:"p-3 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>Xe(s.id),children:[s.title&&e.jsx("h4",{className:"font-medium text-sm line-clamp-1",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mt-1",children:s.content}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:je(s.createdAt)}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{children:[s.likesCount||0," likes"]}),e.jsxs("span",{children:[s.commentsCount||0," comments"]})]})]})]},s.id))})})]}),e.jsxs(I,{className:"hidden",children:[e.jsx(Le,{children:e.jsx(Oe,{className:"text-lg",children:"Community Stats"})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Posts"}),e.jsx("span",{className:"font-medium",children:A.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Active Today"}),e.jsx("span",{className:"font-medium",children:A.filter(s=>new Date(s.createdAt).toDateString()===new Date().toDateString()).length})]})]})})]})]})]})}),!u&&b&&e.jsx(es,{open:b,onOpenChange:S,children:e.jsxs(ss,{className:`${Ct(j,H,Pe,t==null?void 0:t.userType)} flex flex-col transition-all duration-300`,children:[e.jsxs(ts,{className:`flex-shrink-0 ${u?"p-4 border-b bg-background/95 backdrop-blur-sm sticky top-0 z-10":"pb-4"}`,children:[e.jsx(as,{className:u?"text-lg font-semibold":"",children:"Create New Post"}),e.jsx(ls,{className:u?"text-sm text-muted-foreground":"",children:"Share your thoughts with the community"})]}),e.jsx("div",{className:`flex-1 overflow-y-auto overflow-x-hidden ${u?"p-4 pb-20":"pr-2 pb-4"} min-h-0 max-h-full modal-scroll`,style:{WebkitOverflowScrolling:"touch"},children:e.jsxs("div",{className:"space-y-4",children:[(t==null?void 0:t.userType)==="company_profile"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Post Title"}),e.jsx(M,{placeholder:"Enter a title for your post",value:o.title,onChange:s=>P({...o,title:s.target.value}),className:"mt-1","data-testid":"create-post-title"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-medium",children:"Content"}),e.jsx(De,{placeholder:(t==null?void 0:t.userType)==="company_profile"?"What's on your mind?":"Share your thoughts, experiences, or questions... (max 100 characters)",rows:(t==null?void 0:t.userType)==="company_profile"?6:4,value:o.content,onChange:s=>{const a=s.target.value;if((t==null?void 0:t.userType)!=="company_profile"&&a.length>100)return;const l=a.match(/#\w+/g)||[];P(i=>{var d;return{...i,content:a,title:(t==null?void 0:t.userType)==="company_profile"?i.title:"",category:((d=re[0])==null?void 0:d.id)||"general",tags:l.map(w=>w.substring(1))}})},onPaste:s=>{(t==null?void 0:t.userType)!=="company_profile"&&(s.preventDefault(),alert("Please type your message instead of pasting content"))},className:`resize-none border rounded-md p-3 ${(t==null?void 0:t.userType)!=="company_profile"?"pr-16":""} mt-1`,maxLength:(t==null?void 0:t.userType)==="company_profile"?void 0:100,"data-testid":"create-post-content"}),(t==null?void 0:t.userType)!=="company_profile"&&e.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground",children:[o.content.length,"/100"]})]}),!u&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs(is,{value:o.category,onValueChange:s=>P({...o,category:s}),children:[e.jsx(rs,{className:"mt-1","data-testid":"create-post-category",children:e.jsx(ns,{placeholder:"Select a category"})}),e.jsx(os,{children:re.map(s=>e.jsx(ue,{value:s.id,children:s.name},s.id))})]})]}),!u&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags (comma-separated)"}),e.jsx(M,{placeholder:"e.g., #scholarship, #visa, #application",value:o.tags.join(", "),onChange:s=>P({...o,tags:s.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),className:"mt-1","data-testid":"create-post-tags"})]}),(t==null?void 0:t.userType)==="company_profile"&&e.jsxs(e.Fragment,{children:[e.jsxs(_e,{open:j,onOpenChange:L,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-between text-left h-auto py-3",type:"button",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Photos"}),o.images.length>0&&e.jsx(we,{variant:"secondary",className:"ml-2",children:o.images.length})]}),j?e.jsx(Me,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})]})}),e.jsxs(Fe,{className:"space-y-2 pt-2",children:[e.jsx(M,{type:"file",accept:"image/*",multiple:!0,onChange:async s=>{const a=Array.from(s.target.files||[]);if(a.length===0)return;const l=new FormData;a.forEach(i=>{l.append("images",i)});try{const i=await ie.post("/api/forum/upload-images",l);P({...o,images:[...o.images,...i.imageUrls]}),r({title:"Images uploaded",description:`${i.count} image(s) uploaded successfully.`})}catch(i){console.error("Image upload error:",i),r({title:"Upload failed",description:"Failed to upload images. Please try again.",variant:"destructive"})}},className:"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:bg-primary file:text-primary-foreground hover:file:bg-primary/90"}),o.images.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:o.images.map((s,a)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:`Upload ${a+1}`,className:"w-full h-20 object-cover rounded border"}),e.jsx(x,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 h-5 w-5 p-0 text-xs",onClick:()=>{const l=[...o.images];l.splice(a,1),P({...o,images:l})},children:"×"})]},a))})]})]}),e.jsxs(_e,{open:H,onOpenChange:_,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-between text-left h-auto py-3",type:"button",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Poll"}),o.pollQuestion&&e.jsx(we,{variant:"secondary",className:"ml-2",children:"Active"})]}),H?e.jsx(Me,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})]})}),e.jsxs(Fe,{className:"space-y-2 pt-2",children:[e.jsx(M,{placeholder:"Poll question (leave empty for no poll)",value:o.pollQuestion,onChange:s=>P({...o,pollQuestion:s.target.value})}),o.pollQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:o.pollOptions.map((s,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{placeholder:`Option ${a+1}`,value:s.text,onChange:l=>{const i=[...o.pollOptions];i[a]={...s,text:l.target.value},P({...o,pollOptions:i})}}),e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const l=[...o.pollOptions];l.splice(a,1),P({...o,pollOptions:l})},children:"Remove"})]},a))}),o.pollOptions.length<6&&e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{P({...o,pollOptions:[...o.pollOptions,{id:`option_${o.pollOptions.length}`,text:""}]})},children:"Add Option"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-2",children:"Poll End Date"}),e.jsx(M,{type:"datetime-local",value:o.pollEndsAt,onChange:s=>P({...o,pollEndsAt:s.target.value}),"data-testid":"desktop-poll-end-date"})]})]})]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted p-3 rounded",children:[e.jsx("p",{className:"font-medium mb-1",children:"Community Guidelines:"}),e.jsxs("ul",{className:"space-y-1",children:[(t==null?void 0:t.userType)==="company_profile"?e.jsx("li",{children:"• Company profile: Full posting privileges (photos, links, polls allowed)"}):e.jsx("li",{children:"• Text-only posts (no photos, videos, or polls)"}),e.jsx("li",{children:"• No links or phone numbers allowed"}),e.jsx("li",{children:"• Type only (no copy-paste)"}),e.jsx("li",{children:"• Wait 15 seconds between posts"}),e.jsx("li",{children:"• Maximum 10 posts per day"}),e.jsx("li",{children:"• Use #hashtags to categorize your posts"})]})]})]})}),e.jsxs(xt,{className:`flex-shrink-0 pt-4 ${u?"fixed bottom-0 left-0 right-0 p-4 bg-background/95 backdrop-blur-sm border-t z-20":"space-x-2"}`,children:[e.jsx(x,{variant:"outline",onClick:Se,children:"Cancel"}),e.jsx(x,{onClick:Ps,disabled:Ue.isPending||!o.content.trim(),"data-testid":"submit-post",children:Ue.isPending?"Publishing...":"Publish Post"})]})]})}),e.jsx(es,{open:ge,onOpenChange:U,children:e.jsxs(ss,{className:"sm:max-w-[425px] max-w-[95vw] max-h-[90vh] overflow-y-auto z-50",children:[e.jsxs(ts,{children:[e.jsx(as,{children:"Report Post"}),e.jsx(ls,{children:"Help us maintain a safe and respectful community by reporting inappropriate content."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-reason",className:"text-sm font-medium mb-2 block",children:"Reason for reporting *"}),e.jsxs(is,{value:q,onValueChange:W,children:[e.jsx(rs,{children:e.jsx(ns,{placeholder:"Select a reason"})}),e.jsxs(os,{children:[e.jsx(ue,{value:"spam",children:"Spam"}),e.jsx(ue,{value:"harassment",children:"Harassment"}),e.jsx(ue,{value:"inappropriate",children:"Inappropriate Content"}),e.jsx(ue,{value:"offensive",children:"Offensive Language"}),e.jsx(ue,{value:"misinformation",children:"Misinformation"}),e.jsx(ue,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-details",className:"text-sm font-medium mb-2 block",children:"Additional details (optional)"}),e.jsx(De,{id:"report-details",placeholder:"Provide additional context about why you're reporting this post...",value:h,onChange:s=>k(s.target.value),rows:3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(x,{variant:"outline",onClick:()=>{U(!1),z(null),W(""),k("")},children:"Cancel"}),e.jsx(x,{onClick:Ws,disabled:!q.trim()||Ze.isPending,className:"bg-red-600 hover:bg-red-700",children:Ze.isPending?"Reporting...":"Submit Report"})]})]})}),As(),e.jsx(Ms,{images:Ns,initialIndex:bs,isOpen:vs,onClose:()=>Ge(!1)})]})}export{Lt as default};
